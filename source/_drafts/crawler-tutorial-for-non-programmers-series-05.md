---
title: 给非程序员的爬虫教程（五）：文件读写
tags:
  - python
  - 非程序员的爬虫教程
---

Python 提供了`open`函数打开文件，返回一个文件对象，后续我们可以使用这个对象的方法，对文件进行读写。open函数的完整定义为：
`open(file, mode='r', buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None)`
虽然这里列出了很多参数，我们绝大多数情况下，都只需要用到少部分的几个参数即可。

## 常用参数说明
`file`: 文件路径的字符串。这个文件路径，可以是绝对路径，也可以是**相对当前运行环境的路径**。

`mode`: 打开文件的模式，用字符串表示，默认为只读('r')。所有的支持模式列表如下：

| 模式 | 用途 |
| ------| ------ |
| r | 用只读模式打开文件 |
| w | 用写模式打开文件，如果已有同名文件，则覆盖 |
| x | 用于创建文件，如果已有同名文件则失败 |
| a | 用写模式打开文件，如果有同名文件，则追加写入 |
| b | 二进制模式 |
| t | 文本模式(默认) |
| + | 更新文件(读+写) |

这些模式是可以组合使用的，例如默认的`'r'`模式表示以文本只读模式打开一个文件，等同于`rt`。如果我们想用二进制方式写一个文件（例如图片），可以使用模式`'wb'`。如果想在一个已有的文件后继续写入，可以用`'w+'`或`'a'`。

`encoding`: 我们只在文本模式下才会用到，在打开一些非 utf8 格式（例如 gbk）的文本时，需要将其设置为对应的编码字符串。

## 文件操作的相关方法
`read()`：读取文件内容，直至文件结尾。

`readline(size=-1)`：读取一行文件内容（到换行符为止），一般只在文本模式下使用。我们可以传入一个参数`size`来控制最多读取多少个字符。

`readlines()`：读取所有文件内容，返回一个列表，以换行符来分隔每行的元素。

`write(s)`：在文件指针后，写入内容`s`。

`close()`：关闭文件。在关闭后，将不能再对文件进行读写。关闭文件是必要的，否则会出现 **内存泄漏(memory leak)**。

注意，我们每次读取写后，**文件指针**的位置都会改变。我们这里可以简单把文件指针的概念，假想橙我们实际输入时的光标。例如，我们调用`read()`方法，读取完成后，文件指针会指向文件结尾；调用`readline()`后，文件指针就会向后移动一行。

几个简单的 Python 读写文件的示例：
```python
# 文件读取
f = open('test.txt', 'r')
s = f.readline()
print(s)
f.close()

# 文件写入
f = open('test.txt', 'w')
f.write('test string')
f.close()
```

## with 
在实际使用 open 方法时，我们经常会搭配 with ，用于处理错误和自动关闭文件。with 其实是一个 **上下文管理(context manage)** 的关键词，我们暂时将其当作固定用法即可。
```python
with open('test.txt', 'r') as f:
  s = f.readline()
  print(s)
```

## 扩展阅读
1. Python 的 open 方法的[官方文档](https://docs.python.org/3/library/functions.html#open)
2. Python 文件对象方法的[官方文档](https://docs.python.org/3/library/io.html#io.TextIOBase)